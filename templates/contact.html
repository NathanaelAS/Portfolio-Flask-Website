{% extends "base.html" %}


{% block title %}Contact{% endblock %}

{% block head %}
	<script src="https://www.google.com/recaptcha/api.js" async defer></script>
{% endblock %}

{% block styles %}
	<style>
		/* Custom styles for the button with directional fill and arrow effect */
		.my-custom-fill-button {
			position: relative; /* Needed for absolute positioning of ::before and ::after */
			overflow: hidden;   /* Ensures the fill and arrow are clipped */
			padding-right: 2.5em; /* Initial space for the arrow */
			z-index: 1;         /* Ensures button content is above the ::before fill */

			/* Initial state for outline button */
			background-color: transparent; 
			border-color: var(--bs-success);
			color: var(--bs-success); 

			/* Explicit transition for button's own properties */
			/* Ensure background-color transition is listed here as well */
			transition: color 0.3s ease, border-color 0.3s ease, background-color 0.3s ease, padding 0.3s ease; 
		}

		/* ::before pseudo-element for the left-to-right fill effect */
		.my-custom-fill-button::before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			width: 0; /* Starts at 0 width (invisible) */
			height: 100%;
			background-color: var(--bs-success); /* The green fill color */
			z-index: -1; /* Places the fill behind the button's text and ::after arrow */
			transition: width 0.3s ease-out; /* Smooth transition for the width animation */
		}

		/* ::after pseudo-element for the arrow effect */
		.my-custom-fill-button::after {
			content: ' ->'; /* The arrow character and leading space */
			position: absolute;
			right: 0.25em; /* Initial position of the arrow */
			top: 50%;
			transform: translateY(-50%) translateX(10px); /* Move slightly right and center vertically */
			opacity: 0; /* Initially hidden */
			transition: transform 0.3s ease, opacity 0.3s ease; /* Smooth transition for arrow movement and fade */
			font-weight: bold; /* Make the arrow stand out */
			color: inherit; /* Inherit button's text color (will change on hover with the button text) */
			z-index: 2; /* Ensure the arrow is above the fill */
		}

		/* Hover state for the button itself (CRUCIAL OVERRIDES) */
		.my-custom-fill-button:hover {
			/* Force the main button's background to remain transparent on hover. */
			/* This is the key to preventing the instant fill from Bootstrap's default. */
			background-color: transparent !important; 
			
			/* Keep other outline button hover styles consistent */
			border-color: var(--bs-success); /* Border stays green */
			color: var(--bs-white);         /* Text color becomes white */
			padding-right: 1.5em;           /* Adjust padding */
		}

		/* Hover state for the ::before fill effect */
		.my-custom-fill-button:hover::before {
			width: 100%; /* Fills to 100% width on hover */
		}

		/* Hover state for the ::after arrow effect */
		.my-custom-fill-button:hover::after {
			transform: translateY(-50%) translateX(0); /* Slide the arrow to its final position */
			opacity: 1; /* Make the arrow visible */
		}
		.disabled-link {
			pointer-events: none; /* Prevents clicks */
			cursor: default;     /* Changes the cursor */
			opacity: 0.65;       /* Makes it look disabled */
		}
		.g-recaptcha {
			/* You may need to target the iframe directly, but try this first */
			transform: scale(0.85); 
			/* This moves the center of the scaled element to the center of its container */
			transform-origin: 0 0; 
		}
	</style>
{% endblock %}

{% block content %}
	<div class='py-3 bg-light text-center'>
		<h1 class='mt-3'>Contact Me</h1>
	</div>
	
	<div class="container">
		<div class="row">
			<div class="col-md-12">
				<!-- Centered Contact Card -->
				<div class="d-flex justify-content-center mt-5">
					<div class="card text-center shadow-lg" style="width: 18rem;">
						<i class="fa-solid fa-user text-secondary mx-auto mt-4 mb-4"
                			style="font-size: 150px; width: 150px; height: 150px; line-height: 150px;">
						</i>
						<div class="card-body">
							<h5 class="card-title mb-3">Nathanael Spear</h5>
							<a href="#" id="resume-link-btn" class="btn btn-primary mb-3 disabled-link" aria-disabled="true" download>Download My Resume</a>
							<div style="display: flex; gap: 10px; justify-content: center;" class="mb-2">
								<a href="https://www.linkedin.com/in/nathanael-spear-577b85218" target="_blank" class="btn btn-outline-primary"><i class="fa-brands fa-linkedin me-2"></i>LinkedIn</a>
								<a href="https://github.com/NathanaelAS" target="_blank" class="btn btn-outline-dark"><i class="fa-brands fa-github me-2"></i>Github</a>
							</div>
							<form id="email-form">
								<div class="g-recaptcha" data-sitekey="6Lc4gQksAAAAAPktJ9w4xcmBx-nxHtSPB7lLHfTD"></div>

								<button type="submit" id="email-reveal-button" class="btn btn-primary mt-3">Verify to Reveal Email and Download Resume</button>

								<p id="email-result" class="mt-3" style="display: none;"></p>
							</form>
							
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
{% endblock %}

{% block scripts %}
	<script>
		document.getElementById('email-form').addEventListener('submit', function(e){
			e.preventDefault();

			const token = grecaptcha.getResponse();

			if(token.length === 0){
				alert("Please confirm you are not a robot.");
				return;
			}

			verifyRecaptcha(token);
		});

		function verifyRecaptcha(token){
			fetch('/projects/contact/verify-captcha', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				},
				body: JSON.stringify({recaptcha_token: token})
			})
			.then(response => response.json())
			.then(data => {
				const resultElement = document.getElementById('email-result');
				const revealButton = document.getElementById('email-reveal-button');

				const resumeButton = document.getElementById('resume-link-btn');

				if(data.success){
					const email = "nathanaelaspear@gmail.com";

					resultElement.innerHTML = `Email: <a href="mailto:${email}">${email}</a>`;
					resultElement.style.display = 'block';
					revealButton.style.display = 'none';

					if(resumeButton){
						resumeButton.classList.remove('disabled-link');
						resumeButton.removeAttribute('aria-disabled');
					}

					alert('Verification successful! The email address is now visible.');
				} else{
					resultElement.innerHTML = `<span style="color:red;">Verification failed. Please try again.</span>`;
					resultElement.style.display= 'block';

					grecaptcha.reset();
				}
			})
			.catch(error => {
				console.error('Error', error);
				alert('A network error occured during verification.');
			});
		}
	</script>
{% endblock %}
	
